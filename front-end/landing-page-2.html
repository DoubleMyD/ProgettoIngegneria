<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landing Page 2.0</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            margin-top: 20px;
        }
        #content {
            width: 80%;
            margin-top: 20px;
        }
        #pattern-info {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Welcome to Our Service</h1>
    <div id="content">
        <label for="pattern-select">Choose a pattern:</label>
        <select id="pattern-select">
            <option value="">Select a pattern</option>
        </select>
        <div id="pattern-info">
            <h2 id="pattern-name"></h2>
            <p id="pattern-description"></p>
            <p id="pattern-context"></p>
            <p id="pattern-mvc"></p>
            <p id="pattern-strategies"></p>
            <p id="pattern-principles"></p>
            <p id="pattern-owasp-categories"></p>
            <p id="pattern-cwe-categories"></p>
            <p id="pattern-gdpr-articles"></p>
            <p id="pattern-iso-phases"></p>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const apiUrl = 'http://localhost:1337/api/patterns';
            //?populate=*
            async function fetchPatterns() {
                try {
                    const response = await fetch(apiUrl);
                    const patterns = await response.json();
                    populateDropdown(patterns.data);
                } catch (error) {
                    console.error('Error fetching patterns:', error);
                }
            }

            function populateDropdown(patterns) {
                const select = document.getElementById('pattern-select');
                patterns.forEach(pattern => {
                    const option = document.createElement('option');
                    option.value = pattern.id;
                    option.textContent = pattern.attributes.Nome;
                    select.appendChild(option);
                });
            }

            document.getElementById('pattern-select').addEventListener('change', function(event) {
                const patternId = event.target.value;
                if (patternId) {
                    fetchPatternDetails(patternId);
                } else {
                    document.getElementById('pattern-info').style.display = 'none';
                }
            });

            async function fetchPatternDetails(patternId) {
                try {
                    const response = await fetch(`${apiUrl}/${patternId}?populate=*`);
                    const pattern = await response.json();
                    displayPatternDetails(pattern.data);
                    displayPatternMvc(pattern.data);
                    displayPatternStrategies(pattern.data);
                    displayPatternPrinciple(pattern.data);
                    displayPatternOwaspCategories(pattern.data);
                    displayPatternCweCategories(pattern.data);
                    displayPatternGdprArticles(pattern.data);
                    displayPatternIsoPhases(pattern.data);
                } catch (error) {
                    console.error('Error fetching pattern details:', error);
                }
            }

            function displayPatternDetails(pattern) {
                document.getElementById('pattern-name').textContent = pattern.attributes.Nome;
                document.getElementById('pattern-description').textContent = `Descrizione : ${pattern.attributes.descrizione}`;
                document.getElementById('pattern-context').textContent = `Contesto : ${pattern.attributes.contesto}`;
                document.getElementById('pattern-info').style.display = 'block';
            }

            function displayPatternMvc(pattern){
                let string ="MVC collocation : ";
                pattern.attributes.mvcs.data.forEach(mvc => {string += mvc.attributes.collocazione + ' ';});
                document.getElementById('pattern-mvc').textContent = string;
            }

            function displayPatternStrategies(pattern){
                let string ="Strategies : ";
                pattern.attributes.strategias.data.forEach(strategy => {string += strategy.attributes.nome + ' ';});
                document.getElementById('pattern-strategies').textContent = string;
            }

            function displayPatternPrinciple(pattern){
                let string ="Privacy by design principles : ";
                pattern.attributes.privacy_by_design_principles.data.forEach(principle => {string += principle.attributes.nome + ' ';});
                document.getElementById('pattern-principles').textContent = string;
            }

            function displayPatternOwaspCategories(pattern){
                let string ="OWASP categories : ";
                pattern.attributes.owasp_top_10_categories.data.forEach(category => {string += category.attributes.identificatore + ":" + category.attributes.nome + ' ';});
                document.getElementById('pattern-owasp-categories').textContent = string;
            }

            function displayPatternCweCategories(pattern){
                let string ="CWE categories : ";
                pattern.attributes.cwe_top_25_weaknesses.data.forEach(category => {string += category.attributes.identificatore + ":" + category.attributes.weakness + ' ';});
                document.getElementById('pattern-cwe-categories').textContent = string;
            }
            
            function displayPatternGdprArticles(pattern){
                let string ="GDPR Articles : ";
                pattern.attributes.articoli_gdprs.data.forEach(article => {string += article.attributes.numero + ":" + article.attributes.nome + ' ';});
                document.getElementById('pattern-gdpr-articles').textContent = string;
            }

            function displayPatternIsoPhases(pattern){
                let string ="ISO 9241 210 Phases : ";
                pattern.attributes.iso_9241_210_phases.data.forEach(phase => {string += phase.attributes.numero + ":" + phase.attributes.nome + ' ';});
                document.getElementById('pattern-iso-phases').textContent = string;
            }
            // Fetch patterns when the page loads
            fetchPatterns();
        });
    </script>
</body>
</html>
