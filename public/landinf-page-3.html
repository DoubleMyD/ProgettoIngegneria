<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            margin-top: 20px;
        }
        #content {
            width: 80%;
            margin-top: 20px;
        }
        #pattern-info {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Welcome to Our Service</h1>
    <div id="content">
        <label for="pattern-select">Choose a pattern:</label>
        <select id="pattern-select">
            <option value="">Select a pattern</option>
        </select>
        <div id="pattern-info">
            <h2 id="pattern-name"></h2>
            <p id="pattern-description"></p>
            <p id="pattern-context"></p>
            <p id="pattern-mvc"></p>
            <p id="pattern-strategies"></p>
            <p id="pattern-principles"></p>
            <p id="pattern-owasp-categories"></p>
            <p id="pattern-cwe-categories"></p>
            <p id="pattern-gdpr-articles"></p>
            <p id="pattern-iso-phases"></p>
        </div>
    </div>
    <script >
        document.addEventListener('DOMContentLoaded', async function() {
            new PatternController();
        });

        class PatternController {
    constructor() {
        this.model = PatternModel;
        this.view = new PatternView();

        this.initialize();
    }

    async initialize() {
        const patterns = await this.model.fetchPatterns();
        const select = document.getElementById('pattern-select');
                patterns.forEach(pattern => {
                    const option = document.createElement('option');
                    option.value = pattern.id;
                    option.textContent = pattern.attributes.Nome;
                    select.appendChild(option);
                });

        this.view.patternSelect.addEventListener('change', async (event) => {
            const target = event.target;
            if(target instanceof HTMLSelectElement){
                const patternId = target.value;
                if (patternId) {
                  this.updatePatternDetails(patternId);
                } else {
                   this.view.patternInfo.style.display = 'none';
                }
            }
        });
    }

    updatePatternDetails(patternId){
        try{
            const patternData = this.model.fetchPatternDetails(patternId);
            this.view.updatePatternDetails(patternData);
        }catch(error){
            console.error('Error fetching pattern details:', error);
        }
    }
}

        class PatternModel {
    static apiUrl = 'http://localhost:1337/api/patterns';

    static async fetchPatterns() {
        const response = await fetch(PatternModel.apiUrl);
        const patterns = await response.json();
        return patterns.data;
    }

    static async fetchPatternDetails(patternId) {
        const response = await fetch(`${PatternModel.apiUrl}/${patternId}?populate=*`);
        const data = await response.json();
        return data.data;
    }
    }

        class PatternView {
    constructor() {
        this.patternSelect = document.getElementById('pattern-select');
        this.patternInfo = document.getElementById('pattern-info');
        this.patternName = document.getElementById('pattern-name');
        this.patternDescription = document.getElementById('pattern-description');
        this.patternContext = document.getElementById('pattern-context');
        this.patternMvc = document.getElementById('pattern-mvc');
        this.patternStrategies = document.getElementById('pattern-strategies');
        this.patternPrinciples = document.getElementById('pattern-principles');
        this.patternOwaspCategories = document.getElementById('pattern-owasp-categories');
        this.patternCweCategories = document.getElementById('pattern-cwe-categories');
        this.patternGdprArticles = document.getElementById('pattern-gdpr-articles');
        this.patternIsoPhases = document.getElementById('pattern-iso-phases');
    }

    populateDropdown(patterns) {
        //this.patternSelect.innerHTML = '<option value="">Select a pattern</option>';
        patterns.forEach(pattern => {
            const option = document.createElement('option');
            option.value = pattern.id;
            option.textContent = pattern.attributes.Nome;
            document.getElementById('pattern-select').appendChild(option);
        });
    }

    updatePatternDetails(patternData){
        this.displayPatternDetails(patternData);
        this.displayPatternMvc(patternData);
        this.displayPatternStrategies(patternData);
        this.displayPatternPrinciples(patternData);
        this.displayPatternOwaspCategories(patternData);
        this.displayPatternCweCategories(patternData);
        this.displayPatternGdprArticles(patternData);
        this.displayPatternIsoPhases(patternData);
    }

    displayPatternDetails(pattern) {
        this.patternName.textContent = pattern.attributes.Nome;
        this.patternDescription.textContent = `Descrizione : ${pattern.attributes.descrizione}`;
        this.patternContext.textContent = `Contesto : ${pattern.attributes.contesto}`;
        this.patternInfo.style.display = 'block';
    }

    displayPatternMvc(pattern) {
        let string = "MVC collocation : ";
        pattern.attributes.mvcs.data.forEach(mvc => { string += mvc.attributes.collocazione + ' '; });
        this.patternMvc.textContent = string;
    }

    displayPatternStrategies(pattern) {
        let string = "Strategies : ";
        pattern.attributes.strategias.data.forEach(strategy => { string += strategy.attributes.nome + ' '; });
        this.patternStrategies.textContent = string;
    }

    displayPatternPrinciples(pattern) {
        let string = "Privacy by design principles : ";
        pattern.attributes.privacy_by_design_principles.data.forEach(principle => { string += principle.attributes.nome + ' '; });
        this.patternPrinciples.textContent = string;
    }

    displayPatternOwaspCategories(pattern) {
        let string = "OWASP categories : ";
        pattern.attributes.owasp_top_10_categories.data.forEach(category => { string += category.attributes.identificatore + ":" + category.attributes.nome + ' '; });
        this.patternOwaspCategories.textContent = string;
    }

    displayPatternCweCategories(pattern) {
        let string = "CWE categories : ";
        pattern.attributes.cwe_top_25_weaknesses.data.forEach(category => { string += category.attributes.identificatore + ":" + category.attributes.weakness + ' '; });
        this.patternCweCategories.textContent = string;
    }

    displayPatternGdprArticles(pattern) {
        let string = "GDPR Articles : ";
        pattern.attributes.articoli_gdprs.data.forEach(article => { string += article.attributes.numero + ":" + article.attributes.nome + ' '; });
        this.patternGdprArticles.textContent = string;
    }

    displayPatternIsoPhases(pattern) {
        let string = "ISO 9241 210 Phases : ";
        pattern.attributes.iso_9241_210_phases.data.forEach(phase => { string += phase.attributes.numero + ":" + phase.attributes.nome + ' '; });
        this.patternIsoPhases.textContent = string;
    }
}
    </script>
</body>
</html>